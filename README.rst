MIC TOOLS
#########

**Mic Tools** contains python tools to interface X-ray Fluorescence (XRF) data collected at the Advanced Photon Source Microscopy beamlines 2-ID-E and the Bio Nano Probe with `tomoPy <https://tomopy.readthedocs.io/en/latest/>`_

Convert
=======

* Reads 2-ID-E and Bio Nano Probe HDF data and convert them is a single hdf file containing:

/exchange/data[element, theta, y, x]
/exchange/element[]
/exchange/theta[]

as a `tomographic data exchange <https://dxfile.readthedocs.io/en/latest/source/xraytomo.html>`_ that can be directly loaded and reconstructed by tomopy with `rec.py <https://github.com/decarlof/util/tree/master/xrf>`_. XRF data can also be aligned with `align_seq or align_joint <https://tomopy.readthedocs.io/en/latest/api/tomopy.prep.alignment.html#>`_
* Tested with `2-ID-E data <https://anl.box.com/s/qinted32vyrcnjyt7tzs3cx6kreeud3m>`_


Help::
    
    python convert.py -h


Usage::
    
    convert.py [-h]   [--output_fname [OUTPUT_FNAME]]
                      [--theta_index [THETA_INDEX]]
                      dname


positional arguments::

  dname                 directory containing multiple datasets: /data/

optional arguments::

  -h, --help            show this help message and exit
  --output_fname [OUTPUT_FNAME]
                        output file path and prefix (default ./data)
  --theta_index [THETA_INDEX]
                        theta_index: 2-ID-E: 663; 2-ID-E prior 2017: 657; BNP
                        8; (default 657)

Example::

    python convert.py mic_data/  (<= full path to the directory containing the datasets)



Align and reconstruct XRF data with tomoPy
==========================================

To correcly reconstruct the hdf files generated by convert.py is necessary to align the 
projections using for example the tomopy function 
`align_joint <https://tomopy.readthedocs.io/en/stable/api/tomopy.prep.alignment.html#tomopy.prep.alignment.align_joint>`_
`[C8] <https://tomopy.readthedocs.io/en/stable/credits.html#gursoy-17>`_`align.py <https://github.com/decarlof/util/tree/master/xrf>`_:

An example of code using 
`align_joint <https://tomopy.readthedocs.io/en/stable/api/tomopy.prep.alignment.html#tomopy.prep.alignment.align_joint>`_ is
`align.py <https://github.com/decarlof/mic_tools/blob/master/align.py>`_ 

Help::
    
    python align.py -h


Usage::
    
    align.py [-h]   [-h] [--iters [ITERS]] fname


positional arguments::

  dfname            file name of xrf dxchange file: ./data.h5

optional arguments::

  -h, --help        show this help message and exit
  --iters [ITERS]   number of iteration for alignment (default 10)


The aligned projections generate the following reconstructed slice:

.. image:: docs/source/img/recon_align.png
   :width: 320px
   :alt: project


